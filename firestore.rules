rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Room document (now includes board array)
    match /rooms/{roomCode} {
      // Anyone can read rooms
      allow read: if true;
      
      // Anyone can create a room
      allow create: if true;
      
      // Anyone can update room (game logic validation is done in transactions)
      // Note: For production, consider moving game logic to Cloud Functions
      // with proper server-side validation
      allow update: if true;
      
      // Only allow delete if room is empty (no practical way to enforce client-side)
      allow delete: if true;
      
      // Players subcollection
      match /players/{playerId} {
        // Anyone can read players
        allow read: if true;
        
        // Anyone can create their player document
        allow create: if true;
        
        // Players can update (presence, team selection)
        // Note: Ideally would restrict to own document, but playerId is client-generated
        allow update: if true;
        
        // Don't allow player deletion (they disconnect instead)
        allow delete: if false;
      }
      
      // Messages subcollection
      match /messages/{messageId} {
        // Anyone can read messages
        allow read: if true;
        
        // Anyone can create messages
        allow create: if true;
        
        // Messages are immutable
        allow update, delete: if false;
      }
    }
  }
}
